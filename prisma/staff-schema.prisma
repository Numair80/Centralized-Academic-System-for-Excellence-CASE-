// Staff Management Database Schema
generator client {
  provider = "prisma-client-js"
  output   = "../generated/staff-client"
}

datasource db {
  provider = "postgresql"
  url      = env("STAFF_DATABASE_URL")
}

model Staff {
  staff_id        Int      @id @default(autoincrement())
  first_name      String   @db.VarChar(50)
  last_name       String   @db.VarChar(50)
  username        String   @unique @db.VarChar(50)
  password_hash   String?  @db.Text
  email           String   @db.VarChar(100)
  contact_number  String?  @db.VarChar(15)
  department      String?  @db.VarChar(50)
  block_number    String?  @db.VarChar(50)
  room_number     String?  @db.VarChar(10)
  role            String?  @db.VarChar(50)
  availability  String   @default("Available")
  profile_picture String?  @db.Text
  is_active       Boolean  @default(true)

  created_at      DateTime @default(now())
  updated_at      DateTime @updatedAt
  staffavailability StaffAvailability[]
 attendance       StaffAttendance[]
 leave            StaffLeave[]
 StaffNotification      StaffNotification[]
 approvedLeaves StaffLeave[] @relation("LeaveApprover")

  @@map("staff")
}

model StaffAttendance {
  id         Int      @id @default(autoincrement())
  staff_id   Int
  date       DateTime @db.Date
  check_in   DateTime?
  check_out  DateTime?
  status     String   @default("Present") @db.VarChar(20) // Present, Absent, Late, Half Day
  hours      Decimal? @db.Decimal(4, 2)
  created_at DateTime @default(now())

  staff Staff @relation(fields: [staff_id], references: [staff_id], onDelete: Cascade)

  @@unique([staff_id, date])
  @@map("staff_attendance")
}

model StaffLeave {
  id          Int      @id @default(autoincrement())
  staff_id    Int
  leave_type  String   @db.VarChar(50) // Sick, Casual, Annual, Emergency
  start_date  DateTime @db.Date
  end_date    DateTime @db.Date
  reason      String?  @db.Text
  status      String   @default("Pending") @db.VarChar(20) // Pending, Approved, Rejected
  approved_by Int?
  applied_at  DateTime @default(now())
  approved_at DateTime?

  staff    Staff  @relation(fields: [staff_id], references: [staff_id], onDelete: Cascade)
  approver Staff? @relation("LeaveApprover", fields: [approved_by], references: [staff_id])

  @@map("staff_leave")
}

model StaffNotification {
  id         Int      @id @default(autoincrement())
  staff_id   Int // FIXED: Changed from BigInt to Int
  title      String   @db.VarChar(200)
  message    String   @db.Text
  type       String   @default("General") @db.VarChar(50)
  is_read    Boolean  @default(false)
  created_at DateTime @default(now())
  read_at    DateTime?

  staff      Staff    @relation(fields: [staff_id], references: [staff_id], onDelete: Cascade)

  @@map("staff_notification")
}

model StaffAvailability {
  id         Int      @id @default(autoincrement())
  staff_id   Int
  status     String   @default("Available") @db.VarChar(50) // Available, Busy, On Leave, etc.
  from_time  DateTime
  to_time    DateTime
  created_at DateTime @default(now())

  staff Staff @relation(fields: [staff_id], references: [staff_id], onDelete: Cascade)

  @@map("staff_availability")
}
