// Events Management Database Schema
generator client {
  provider = "prisma-client-js"
  output   = "../generated/events-client"
}

datasource db {
  provider = "postgresql"
  url      = env("EVENTS_DATABASE_URL")
}

model Event {
  id           Int      @id @default(autoincrement())
  title        String   @db.VarChar(255)
  description  String?  @db.Text
  event_date   DateTime @db.Date
  start_time   DateTime?
  end_time     DateTime?
  venue        String?  @db.VarChar(200)
  location     String?  @db.VarChar(200)
  department   String?  @db.VarChar(100)
  category_id  Int?
  organizer    String?  @db.VarChar(100)
  contact_info String?  @db.VarChar(200)
  image_url    String?  @db.Text
  banner_url   String?  @db.Text
  max_capacity Int?
  registration_required Boolean @default(false)
  registration_deadline DateTime?
  entry_fee    Decimal? @db.Decimal(10, 2)
  status       String   @default("Upcoming") @db.VarChar(20) // Upcoming, Ongoing, Completed, Cancelled
  priority     String   @default("Normal") @db.VarChar(20) // Low, Normal, High
  is_featured  Boolean  @default(false)
  is_public    Boolean  @default(true)
  created_by   String?  @db.VarChar(100)
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt

  EventCategory      EventCategory? @relation(fields: [category_id], references: [id])
  EventRegistration EventRegistration[]
  EventAttendee     EventAttendee[]
  EventNotification      EventNotification[]

  @@map("events")
}

model EventCategory {
  id          Int      @id @default(autoincrement())
  name        String   @unique @db.VarChar(100)
  description String?  @db.Text
  color       String?  @db.VarChar(7) // Hex color code
  icon        String?  @db.VarChar(50)
  is_active   Boolean  @default(true)
  created_at  DateTime @default(now())

  events Event[]

  @@map("event_categories")
}

model EventRegistration {
  id           Int      @id @default(autoincrement())
  event_id     Int
  user_id      String   @db.VarChar(50)
  user_name    String   @db.VarChar(100)
  user_email   String   @db.VarChar(100)
  user_phone   String?  @db.VarChar(15)
  user_type    String   @db.VarChar(20) // Student, Faculty, External
  department   String?  @db.VarChar(100)
  special_requirements String? @db.Text
  payment_status String @default("Pending") @db.VarChar(20) // Pending, Paid, Failed
  registration_date DateTime @default(now())

  event Event @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, user_id])
  @@map("event_registrations")
}

model EventAttendee {
  id          Int      @id @default(autoincrement())
  event_id    Int
  user_id     String   @db.VarChar(50)
  user_name   String   @db.VarChar(100)
  check_in_time DateTime?
  check_out_time DateTime?
  attendance_status String @default("Registered") @db.VarChar(20) // Registered, Present, Absent
  feedback_rating Int?   @db.SmallInt
  feedback_comment String? @db.Text
  created_at  DateTime @default(now())

  event Event @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@unique([event_id, user_id])
  @@map("event_attendees")
}

model EventNotification {
  id         Int      @id @default(autoincrement())
  event_id   Int
  title      String   @db.VarChar(200)
  message    String   @db.Text
  target_audience String @db.VarChar(100) // All, Students, Faculty, Registered
  department String?  @db.VarChar(100)
  sent_at    DateTime @default(now())
  sent_by    String   @db.VarChar(100)

  event Event @relation(fields: [event_id], references: [id], onDelete: Cascade)

  @@map("event_notifications")
}
