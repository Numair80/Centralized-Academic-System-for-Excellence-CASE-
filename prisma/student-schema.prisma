// Student Management Database Schema
generator client {
  provider = "prisma-client-js"
  output   = "../generated/student-client"
}

datasource db {
  provider = "postgresql"
  url      = env("STUDENT_DATABASE_URL")
}

model Student {
  student_id      BigInt   @id
  first_name      String   @db.VarChar(50)
  last_name       String   @db.VarChar(50)
  email_id        String   @unique @db.VarChar(100)
  password_hash   String?
  contact_number  String   @db.VarChar(15)
  admission_year DateTime? // change from Int? to DateTime?
  
  year            Int?     
  current_date    DateTime? @default(now())
  department      String?  @db.VarChar(50)
  semester        Int?     @default(1)
  section         String?  @db.VarChar(10)
  profile_picture String?
  cgpa            Decimal? @db.Decimal(3, 2)
  created_at      DateTime @default(now())
  updated_at DateTime @default(now()) @db.Timestamp(6)


  attendance StudentAttendance[]
  marks StudentMarks[]
  assignment StudentAssignment[]
  studentNotification StudentNotification[]
  internalmarks InternalMarks[] 

  @@map("student")
}

model StudentAttendance {
  id         Int      @id @default(autoincrement())
  student_id BigInt
  subject    String   @db.VarChar(100)
  date       DateTime @db.Date
  status     String   @db.VarChar(20) // Present, Absent, Late
  period     Int?     @default(1)
  marked_by  String?  @db.VarChar(50)
  created_at DateTime @default(now())

  student Student @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@unique([student_id, subject, date, period])
  @@map("student_attendance")
}

model StudentMarks {
  id          Int     @id @default(autoincrement())
  student_id  BigInt
  subject     String  @db.VarChar(100)
  exam_type   String  @db.VarChar(50) // Internal, Mid-term, Final, Assignment
  marks       Decimal @db.Decimal(5, 2)
  max_marks   Decimal @db.Decimal(5, 2)
  grade       String? @db.VarChar(5)
  semester    Int
  academic_year String @db.VarChar(10)
  created_at  DateTime @default(now())

  student Student @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@map("student_marks")
}

model StudentAssignment {
  id          Int      @id @default(autoincrement())
  student_id  BigInt
  title       String   @db.VarChar(200)
  subject     String   @db.VarChar(100)
  description String?  @db.Text
  due_date    DateTime
  status      String   @default("Pending") @db.VarChar(20) // Pending, Submitted, Late, Graded
  marks       Decimal? @db.Decimal(5, 2)
  max_marks   Decimal? @db.Decimal(5, 2)
  submitted_at DateTime?
  created_at  DateTime @default(now())

  student Student @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@map("student_assignment")
}

model StudentNotification {
  id          Int      @id @default(autoincrement())
  student_id   BigInt
  title       String   @db.VarChar(200)
  message     String   @db.Text
  department  String?  @db.VarChar(50)
  section     String?  @db.VarChar(10)
  priority    String   @default("Normal") @db.VarChar(20)
  type        String   @db.VarChar(50)  // e.g. "admin_notification"
  isRead      Boolean  @default(false)
  created_at  DateTime @default(now())

  student     Student  @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@map("student_notification")
}

model Subject {
  id           BigInt   @id @default(autoincrement())
  subject_code String   @unique @db.VarChar(20)
  name         String   @db.VarChar(100)
  department   String?  @db.VarChar(50)
  semester     Int?
  credits      Int?     @default(3)
  faculty_id   BigInt?
  created_at   DateTime @default(now())
  updated_at   DateTime @updatedAt
  

  @@map("subjects")
}

model InternalMarks {
  id              BigInt      @id @default(autoincrement())
  student_id      BigInt
  subject         String
  academic_year   String
  internal1_marks Int         @db.SmallInt
  internal2_marks Int         @db.SmallInt
  assignment_marks Int        @db.SmallInt
  total_marks     Int         @db.SmallInt
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt

  // Relations
  student         Student     @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@unique([student_id, subject, academic_year])
  @@map("internal_marks")
}
